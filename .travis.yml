dist: trusty

language: ruby

node_js: "8"

cache:
  bundler: true
  yarn: true
  directories:
    - node_modules

bundler_args: --deployment --without development production --jobs=$(nproc) --retry=3

branches:
  only:
    - master

env:
  - DISPLAY=:0.0
    BOT_USERNAME=kite-bot
    BOT_NAME="Kite Bot"
    BOT_EMAIL=kite-bot@heliostech.fr

services:
  - mysql

addons:
  chrome: stable

# Execute all of the commands which need to be executed before installing dependencies.
before_install: npm install -g yarn

# Execute all of the commands which need to be executed before running actual tests.
before_script:
  - bundle exec rake yarn:install db:create db:migrate

# Execute all of the commands which should make the build pass or fail.
script: xvfb-run --auto-servernum --server-args="-screen 0 1280x800x16" bundle exec rspec

# Execute all of the commands which need to be executed after the build passed.
after_success: env && ruby ci/bump.rb

# Execute all of the commands which need to be executed after the build failed.
after_failure:
