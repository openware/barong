## Barong 1.7.0 (April 18, 2018) ##

### Overview ###

  This release is focused on:

  1. Implementation of `2FA API`
  2. Complete `KYC API`

  The release also includes various fixes and improvements.

### Breaking changes ###

  * [#368](https://github.com/rubykube/barong/pull/368): Restify api routes

  **Migration steps**:

  * `/api/v1/account` changed to `/api/v1/accounts/me`

  * `/api/v1/account/password` changed to `/api/v1/accounts/me/password`
  *
  * `/api/v1/profile` changed to `/api/v1/profiles/me`

### New features ###

* [#327](https://github.com/rubykube/barong/pull/327): Implement 2FA API

  The patch adds endpoints:

  * `POST /api/v1/security/generate_qrcode`

    The API endpoint returns new Vault TOTP object if it has not generated yet.
    TOTP object has `data` hash field that contains two keys `barcode` and `url`

    * `barcode` is a base64 qr code image
    * `url` is a url for external applications like Google Authenticator

    Responds with `400` code if 2FA is already enabled

  * `POST /api/v1/security/enable_2fa`

    The API endpoint returns enables 2FA and sets `otp_enabled` flag to current account

    Requires `code as string`. It's code from Google Authenticator or similar apps

    Responds with `400` code if 2FA is already enabled

    Responds with `422` code if provided code is not valid

  * `POST /api/v1/security/verify_code`

    The API endpoint verifies code

    Requires `code as string`. It's code from Google Authenticator or similar apps

    Responds with `400` code if 2FA is not enabled

    Responds with `422` code if provided code is not valid

  The patch fixes bug when we enable 2FA without verifying code in controller [#237](https://github.com/rubykube/barong/issues/237)

* [#336](https://github.com/rubykube/barong/pull/336): Implement Profiles API (Part of KYC API).

  The patch adds endpoint:

  * `POST /api/v1/profiles`

    The API endpoint creates a profile if profile is not created.

    Requires this fields:
      * `first_name, type: String`
      * `last_name, type: String`
      * `dob, type: Date`
      * `address, type: String`
      * `postcode, type: String`
      * `city, type: String`
      * `country, type: String`

    Optional param: `metadata`
    `metadata` saves external profile fields as json hash.
    For example `metadata: {"state":"Alabama"}`

### Fixes ###

* [#327](https://github.com/rubykube/barong/pull/327): Fix 2FA bug that enabled 2FA without checking code

* [#341](https://github.com/rubykube/barong/pull/341): Fix bug when user can verify phone without providing code from sms

  The patch is also pushed to 1-5-stable and 1-6-stable

* [#360](https://github.com/rubykube/barong/pull/360): When admin rejects profile, account's level changes to level 2
